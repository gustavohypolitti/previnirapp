<!doctype html>
<html lang="pt-BR">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Entrar — PrevinirApp</title>
<style>
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; background:#f8fafc; margin:0}
  .wrap{max-width:440px;margin:8vh auto;padding:18px}
  .card{background:#fff;border:1px solid #e6ecf4;border-radius:14px;box-shadow:0 10px 30px rgba(16,24,40,.06);padding:16px}
  label{display:block;margin-top:10px;font-weight:600}
  input{width:100%;padding:11px 12px;border:1px solid #d7e0ea;border-radius:10px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;margin-top:12px;background:#28c76f;color:#0b1220}
  .muted{color:#667085;font-size:.9rem}
  .otp-row{display:grid;grid-template-columns:2fr 1fr;gap:8px}
</style></head>
<body>
<div class="wrap">
  <h1>PrevinirApp</h1>
  <div class="card">
    <h3>Entrar</h3>
    <label for="email">E-mail</label><input id="email" type="email">
    <label for="senha">Senha</label><input id="senha" type="password">
    <button class="btn" id="btnLogin">Entrar</button>
    <div class="muted">Não tem conta? Cadastre-se abaixo.</div>
  </div>
  <div class="card" style="margin-top:12px">
    <h3>Criar conta</h3>
    <div class="row">
      <div><label>Nome</label><input id="r_nome"></div>
      <div><label>CPF</label><input id="r_cpf" placeholder="000.000.000-00"></div>
    </div>
    <label>E-mail</label><input id="r_email" type="email">
    <label>Celular</label><input id="r_phone" placeholder="(00) 90000-0000">
    <label>Senha</label><input id="r_senha" type="password">
    <label>Verificação por SMS</label>
    <div class="otp-row">
      <input id="otp_code" placeholder="Código de 6 dígitos">
      <button class="btn" id="btnSendOtp" type="button">Enviar código</button>
    </div>
    <button class="btn" id="btnRegister">Criar conta</button>
    <div class="muted">Você receberá um código por SMS (ou confira o console do servidor em ambiente de teste).</div>
  </div>
</div>
<script>
  function maskCPF(v){ v=v.replace(/\D/g,'').slice(0,11); v=v.replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2'); return v;}
  function maskPhone(v){ v=v.replace(/\D/g,'').slice(0,11); if(v.length<=10) return v.replace(/(\d{2})(\d{4})(\d{0,4})/,'($1) $2-$3').trim(); return v.replace(/(\d{2})(\d{5})(\d{0,4})/,'($1) $2-$3').trim();}
  const cpfEl = document.getElementById('r_cpf'); cpfEl.addEventListener('input', e=> e.target.value=maskCPF(e.target.value));
  const phoneEl = document.getElementById('r_phone'); phoneEl.addEventListener('input', e=> e.target.value=maskPhone(e.target.value));

  document.getElementById('btnSendOtp').onclick = async ()=>{
    const phone = phoneEl.value;
    const r = await fetch('/v1/otp/send', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({phone})});
    if(r.ok) alert('Código enviado!'); else alert('Falha ao enviar código.');
  };
  document.getElementById('btnRegister').onclick = async ()=>{
    const body = {
      name: document.getElementById('r_nome').value,
      cpf: document.getElementById('r_cpf').value,
      email: document.getElementById('r_email').value,
      phone: document.getElementById('r_phone').value,
      password: document.getElementById('r_senha').value,
      otp_code: document.getElementById('otp_code').value
    };
    const r = await fetch('/auth/register',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
    if(r.ok){
      const data = await r.json();
      localStorage.setItem('token', data.token);
      alert('Conta criada! Você está logado.');
      location.href = 'painel.html';
    } else {
      const t = await r.text(); alert('Erro: '+t);
    }
  };
  document.getElementById('btnLogin').onclick = async ()=>{
    const r = await fetch('/auth/login',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email: document.getElementById('email').value, password: document.getElementById('senha').value})});
    if(r.ok){
      const data = await r.json();
      localStorage.setItem('token', data.token);
      location.href = 'painel.html';
    } else alert('Login inválido.');
  };
</script>
</body>
</html>
