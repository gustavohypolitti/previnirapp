<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PrevinirApp ‚Äî Rastreamento Personalizado</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cpath fill='%2328c76f' d='M12 28c0-9.94 8.06-18 18-18s18 8.06 18 18-8.06 18-18 18S12 37.94 12 28z'/%3E%3Cpath fill='%23fff' d='M31 18h2v20h-2z'/%3E%3Cpath fill='%23fff' d='M22 27h20v2H22z'/%3E%3C/svg%3E">
<meta name="color-scheme" content="light dark">
<style>
  :root{ --bg:#08131f; --brand:#28c76f; --brand-2:#00b894; --ink:#0b1220; --muted:#667085; --card:#ffffff; --border:#e6ecf4; --accent:#3b82f6; }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Noto Sans,sans-serif;background:#f5faf7;color:#0f172a;line-height:1.35}
  a{color:var(--accent);text-decoration:none}
  header.hero{position:relative;min-height:68vh;display:grid;place-items:center;color:#fff;background:
    linear-gradient( to bottom right, rgba(8,19,31,.75), rgba(8,19,31,.55) ),
    url('https://images.unsplash.com/photo-1511895426328-dc8714191300?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat;}
  nav{position:absolute;top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:14px 18px}
  .brand{display:flex;gap:.6rem;align-items:center;color:#fff;font-weight:800}
  .brand .mark{width:28px;height:28px;display:inline-grid;place-items:center;background:linear-gradient(135deg,var(--brand),var(--brand-2));border-radius:8px;color:#fff}
  .navlinks a{color:#fff;margin-left:12px;font-weight:600;opacity:.95}
  .hero .content{max-width:1100px;padding:64px 24px;text-align:center}
  h1{font-size:clamp(2rem,3.4vw,3.25rem);margin:.2rem 0 .7rem}
  .slogan{font-size:clamp(1.05rem,1.5vw,1.25rem);opacity:.96;max-width:900px;margin:0 auto 18px}
  .slogan strong{color:#a7f3d0}
  .cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:14px}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer;transition:.2s;letter-spacing:.2px}
  .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#08131f}
  .btn.primary:hover{filter:brightness(1.05)}
  .btn.ghost{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.28)}
  main{max-width:1150px;margin:-56px auto 72px;padding:0 16px}
  .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:20px;align-items:start}
  .card{background:var(--card);border-radius:18px;border:1px solid var(--border);box-shadow:0 10px 30px rgba(16,24,40,.06);padding:18px 16px 16px}
  .card h2{margin:6px 0 6px;font-size:1.25rem}
  form .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  form .row-3{grid-template-columns:repeat(3,1fr)}
  label{display:block;font-weight:600;color:#111827;margin-top:10px}
  input,select,textarea{width:100%;padding:11px 12px;border:1px solid #d7e0ea;border-radius:10px;font-size:15px;outline:none;background:#fff}
  input:invalid{border-color:#fecaca}
  small.help{display:block;color:#6b7280;margin-top:4px}
  .section-title{margin:4px 0 8px;color:#0b1220;font-weight:800;font-size:1rem;text-transform:uppercase;letter-spacing:.6px}
  .muted{color:#667085}
  .results{margin-top:12px}
  .badge{display:inline-block;padding:.25rem .5rem;border-radius:999px;background:#eef6ff;border:1px solid #dbeafe;color:#0b4fa0;font-weight:700;font-size:.75rem;margin:0 .25rem .25rem 0}
  .rec{border-left:4px solid #dbeafe;padding-left:10px;margin:10px 0 14px}
  .rec h3{margin:.1rem 0;font-size:1rem}
  .rec .meta{font-size:.85rem;color:#334155}
  .rec .actions{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
  .rec .actions .btn{padding:8px 12px;font-weight:700}
  .pill-diff{background:#fff5e9;border:1px solid #ffd9b0;color:#a64800}
  .pdfbar{display:none;position:sticky;top:0;background:#fff;border:1px dashed #cbd5e1;border-radius:12px;padding:10px;margin:8px 0;z-index:2}
  .pdfbar .btn{padding:8px 12px}
  footer{max-width:1150px;margin:0 auto 64px;padding:0 16px;color:#52607e}
  .disclaimer{font-size:.87rem}
  @media print { header.hero, .cta, #cadastro, #como-funciona, nav { display:none !important; } .rec{break-inside:avoid} .pdfbar{display:none !important} footer{page-break-after:avoid} }
  @media (max-width:980px){.grid{grid-template-columns:1fr} .navlinks{display:none}}
  .rightnav{display:inline-flex;gap:10px;align-items:center}
</style>
</head>
<body>
<header class="hero" role="banner" aria-label="PrevinirApp">
  <nav>
    <div class="brand"><span class="mark">ü©∫</span> <span>Previnir<b>App</b></span></div>
    <div class="navlinks rightnav">
      <a href="sobre.html">Quem somos</a>
      <a href="painel.html">Painel</a>
      <a href="login.html">Entrar</a>
    </div>
  </nav>
  <div class="content">
    <h1>Previna hoje. Viva mais.</h1>
    <p class="slogan">Detec√ß√£o precoce salva vidas. Descubra agora <strong>quais exames de rastreamento</strong> voc√™ deve fazer para o seu perfil ‚Äî com base em diretrizes do Brasil e internacionais.</p>
    <div class="cta">
      <a href="#cadastro" class="btn primary">Come√ßar meu cadastro</a>
      <a href="sobre.html" class="btn ghost">Quem somos</a>
    </div>
  </div>
</header>

<main>
  <div class="grid">
    <section id="cadastro" class="card" aria-labelledby="cadastro-title">
      <h2 id="cadastro-title">Cadastro e Question√°rio</h2>
      <form id="form" novalidate>
        <div class="section-title">Dados de acesso</div>
        <div class="row">
          <div><label for="nome">Nome</label><input id="nome" required autocomplete="name" /></div>
          <div><label for="cpf">CPF</label><input id="cpf" inputmode="numeric" placeholder="000.000.000-00" required /></div>
        </div>
        <div class="row">
          <div><label for="email">E-mail</label><input id="email" type="email" required autocomplete="email" /></div>
          <div><label for="cel">Celular</label><input id="cel" inputmode="tel" placeholder="(00) 90000-0000" required /></div>
        </div>
        <div class="row">
          <div><label for="senha">Senha</label><input id="senha" type="password" required minlength="8" /></div>
          <div><label for="dob">Data de nascimento</label><input id="dob" type="date" required /></div>
        </div>

        <div class="section-title">Perfil de sa√∫de</div>
        <div class="row">
          <div><label for="sexo">Sexo de nascimento</label><select id="sexo" required><option value="">Selecione‚Ä¶</option><option>Feminino</option><option>Masculino</option></select></div>
          <div><label for="ativo">Sexualmente ativo?</label><select id="ativo" required><option value="">Selecione‚Ä¶</option><option>Sim</option><option>N√£o</option></select></div>
        </div>

        <div class="section-title">Tabagismo</div>
        <div class="row-3 row">
          <div><label for="fumante">Fuma atualmente?</label><select id="fumante" required><option value="">Selecione‚Ä¶</option><option>N√£o</option><option>Ex-fumante</option><option>Sim</option></select></div>
          <div><label for="macos_dia">Ma√ßos/dia (m√©dia)</label><input id="macos_dia" type="number" step="0.1" min="0" placeholder="1.0" /></div>
          <div><label for="anos_fumou">Anos que fumou</label><input id="anos_fumou" type="number" step="1" min="0" placeholder="20" /></div>
        </div>
        <div class="row">
          <div><label for="parou_ha">Se parou, h√° quantos anos?</label><input id="parou_ha" type="number" step="1" min="0" placeholder="8" /></div>
          <div><label for="exposicao_passiva">Exposi√ß√£o passiva importante?</label><select id="exposicao_passiva"><option>N√£o</option><option>Sim</option></select></div>
        </div>
        <small class="help">*Pack-years = ma√ßos/dia √ó anos que fumou.</small>

        <div class="section-title">Hist√≥rico familiar (1¬∫ grau) e alto risco</div>
        <div class="row">
          <div><label for="hf_mama">C√¢ncer de mama (m√£e/irm√£/filha)?</label><select id="hf_mama"><option>N√£o</option><option>Sim</option></select></div>
          <div><label for="hf_prostata">C√¢ncer de pr√≥stata (pai/irm√£o/filho)?</label><select id="hf_prostata"><option>N√£o</option><option>Sim</option></select></div>
        </div>
        <div class="row">
          <div><label for="hf_colorretal">C√¢ncer colorretal (1¬∫ grau &lt;60a)?</label><select id="hf_colorretal"><option>N√£o</option><option>Sim</option></select></div>
          <div><label for="condicoes">Doen√ßas/condi√ß√µes relevantes</label><input id="condicoes" placeholder="ex.: cirrose, DII, RT tor√°cica <30a, BRCA/Lynch" /></div>
        </div>

        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn primary" type="submit">Ver meus exames recomendados</button>
          <button class="btn" type="reset">Limpar</button>
        </div>
      </form>
    </section>

    <aside id="resultado" class="card" aria-live="polite">
      <h2>Recomenda√ß√µes personalizadas</h2>
      <div class="pdfbar" id="pdfbar">
        <span class="muted">Exporte suas orienta√ß√µes:</span>
        <button class="btn" id="btn-print" type="button">Baixar PDF</button>
      </div>
      <p class="muted" id="intro">Preencha o cadastro e o question√°rio para ver aqui seus exames recomendados.</p>
      <div class="results" id="recs"></div>
    </aside>
  </div>

  <section id="como-funciona" class="card" aria-labelledby="como-title">
    <h2 id="como-title">Como o PrevinirApp decide os exames?</h2>
    <p>Usamos regras inspiradas em diretrizes do Minist√©rio da Sa√∫de/INCA e, para compara√ß√£o, USPSTF/ACS/NCCN. Onde houver diferen√ßas, mostramos <span class="badge pill-diff">diverg√™ncias</span>. Este site √© informativo e n√£o substitui consulta m√©dica.</p>
  </section>
</main>

<footer><p class="disclaimer">‚ö†Ô∏è Use as recomenda√ß√µes para discutir com seu profissional de sa√∫de. Este produto n√£o substitui avalia√ß√£o m√©dica.</p></footer>

<script>
  const form = document.getElementById('form');
  const recsEl = document.getElementById('recs');
  const introEl = document.getElementById('intro');
  const pdfbar = document.getElementById('pdfbar');
  const btnPrint = document.getElementById('btn-print');

  const cpfEl = document.getElementById('cpf');
  const celEl = document.getElementById('cel');
  const emailEl = document.getElementById('email');
  const senhaEl = document.getElementById('senha');

  function maskCPF(v){ v=v.replace(/\D/g,'').slice(0,11); v=v.replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2'); return v;}
  function maskPhone(v){ v=v.replace(/\D/g,'').slice(0,11); if(v.length<=10) return v.replace(/(\d{2})(\d{4})(\d{0,4})/,'($1) $2-$3').trim(); return v.replace(/(\d{2})(\d{5})(\d{0,4})/,'($1) $2-$3').trim();}
  cpfEl.addEventListener('input', e=> e.target.value = maskCPF(e.target.value));
  celEl.addEventListener('input', e=> e.target.value = maskPhone(e.target.value));

  function cpfValido(cpf){
    cpf = cpf.replace(/\D/g,'');
    if(!cpf || cpf.length!==11 || /^([0-9])\1+$/.test(cpf)) return false;
    let soma=0; for(let i=0;i<9;i++) soma += parseInt(cpf.charAt(i))*(10-i);
    let d1 = 11 - (soma % 11); d1 = (d1>9)?0:d1;
    soma=0; for(let i=0;i<10;i++) soma += parseInt(cpf.charAt(i))*(11-i);
    let d2 = 11 - (soma % 11); d2 = (d2>9)?0:d2;
    return d1===parseInt(cpf.charAt(9)) && d2===parseInt(cpf.charAt(10));
  }

  function idadeFromDOB(dob){ if(!dob) return null; const d=new Date(dob); const t=new Date(); let age=t.getFullYear()-d.getFullYear(); const m=t.getMonth()-d.getMonth(); if(m<0||(m===0&&t.getDate()<d.getDate())) age--; return age;}
  function packYears(macosDia, anos){macosDia=parseFloat(macosDia||0);anos=parseFloat(anos||0);return +(macosDia*anos).toFixed(1);}
  function openMaps(query, coords){ const base=`https://www.google.com/maps/search/${encodeURIComponent(query)}`; if(coords){ window.open(`${base}/@${coords.latitude},${coords.longitude},14z`,'_blank'); } else { window.open(base,'_blank'); }}

  async function agendar(queryAgendar, examLabel){
    let coords=null; try{ coords = await new Promise((resolve,reject)=>{ navigator.geolocation.getCurrentPosition(p=>resolve(p.coords), reject, {timeout:4000}); }); }catch(e){}
    const endpoint='/v1/clinics'; let clinics=null;
    try{ const url=new URL(endpoint, window.location.origin); url.searchParams.set('exam', queryAgendar); if(coords){ url.searchParams.set('lat', coords.latitude); url.searchParams.set('lng', coords.longitude); } const res=await fetch(url.toString(), {headers:{'Accept':'application/json'}}); if(res.ok){ const data=await res.json(); clinics=data.clinics||null; } }catch(err){ clinics=null; }
    if(!clinics||!clinics.length){ openMaps(queryAgendar, coords); return; }
    const modal=document.createElement('div'); Object.assign(modal.style,{position:'fixed',inset:'0',background:'rgba(0,0,0,.4)',display:'grid',placeItems:'center',zIndex:9999});
    const inner=document.createElement('div'); inner.className='card'; inner.style.maxWidth='780px'; inner.style.width='min(95vw,780px)'; inner.innerHTML=`<h3>Locais pr√≥ximos para: ${examLabel}</h3>`;
    clinics.slice(0,8).forEach((cl)=>{ const row=document.createElement('div'); row.style.display='grid'; row.style.gridTemplateColumns='1fr auto'; row.style.alignItems='center'; row.style.padding='8px 0'; row.style.gap='8px'; row.style.borderTop='1px dashed #e2e8f0';
      row.innerHTML=`<div><b>${cl.name}</b><div class="muted" style="font-size:.85rem">${cl.address||''}</div>${cl.distance_km!=null?`<div class="badge">${cl.distance_km.toFixed(1)} km</div>`:''}</div>`;
      const actions=document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px';
      const go=document.createElement('button'); go.className='btn'; go.type='button'; go.textContent='Rotas'; go.onclick=()=>openMaps(cl.name+' '+(cl.address||''), {latitude:cl.lat, longitude:cl.lng});
      const save=document.createElement('button'); save.className='btn primary'; save.type='button'; save.textContent='Salvar agendamento';
      save.onclick=async()=>{ const body={ exam: examLabel, clinic: cl, user:{ nome: document.getElementById('nome').value, email: document.getElementById('email').value } };
        try{ const res=await fetch('/v1/bookings',{method:'POST', headers:{'Content-Type':'application/json', 'Authorization': 'Bearer '+(localStorage.getItem('token')||'')}, body: JSON.stringify(body)}); if(res.ok){ alert('Agendamento salvo!'); } else if(res.status===401){ alert('Para salvar, fa√ßa login (menu Entrar).'); } else { alert('N√£o foi poss√≠vel salvar agora.'); } }catch(e){ alert('Falha de conex√£o.'); } };
      actions.appendChild(go); actions.appendChild(save); row.appendChild(actions); inner.appendChild(row); });
    const close=document.createElement('button'); close.className='btn'; close.textContent='Fechar'; close.style.marginTop='10px'; close.onclick=()=>document.body.removeChild(modal);
    inner.appendChild(close); modal.appendChild(inner); modal.addEventListener('click',(e)=>{ if(e.target===modal) document.body.removeChild(modal); }); document.body.appendChild(modal);
  }

  function addRec({titulo, quando, diretrizes, divergencia, queryAgendar}){
    const wrap=document.createElement('div'); wrap.className='rec';
    wrap.innerHTML=`<h3>${titulo}</h3><div class="meta"><b>Periodicidade:</b> ${quando}</div><div class="meta"><b>Diretrizes base:</b> ${diretrizes}</div>${divergencia?`<div class="badge pill-diff">Diverg√™ncia: ${divergencia}</div>`:''}<div class="actions"><button class="btn" type="button" aria-label="Agendar ${titulo}">Agendar</button></div>`;
    wrap.querySelector('button').addEventListener('click',()=>agendar(queryAgendar, titulo)); recsEl.appendChild(wrap);
  }
  btnPrint?.addEventListener('click', ()=>window.print());

  form.addEventListener('submit', e=>{
    e.preventDefault();
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailEl.value)){ alert('E-mail inv√°lido'); return; }
    if(senhaEl.value.length<8){ alert('A senha deve ter pelo menos 8 caracteres.'); return; }
    if(!cpfValido(cpfEl.value)){ alert('CPF inv√°lido.'); return; }

    recsEl.innerHTML=''; introEl.style.display='none'; pdfbar.style.display='block';

    const sexo=document.getElementById('sexo').value;
    const dob=document.getElementById('dob').value;
    const idade=idadeFromDOB(dob);
    const fumante=document.getElementById('fumante').value;
    const macos_dia=document.getElementById('macos_dia').value;
    const anos_fumou=document.getElementById('anos_fumou').value;
    const parou_ha=parseFloat(document.getElementById('parou_ha').value||0);
    const pYears=packYears(macos_dia, anos_fumou);
    const ativo=document.getElementById('ativo').value;
    const hf_mama=document.getElementById('hf_mama').value==='Sim';
    const hf_prostata=document.getElementById('hf_prostata').value==='Sim';
    const hf_colorretal=document.getElementById('hf_colorretal').value==='Sim';
    const condicoes=(document.getElementById('condicoes').value||'').toLowerCase();

    const hasBRCA=/brca/.test(condicoes);
    const chestRTyoung=/radioterapia.*tora|torac/i.test(condicoes)||/rt.*tora/i.test(condicoes);
    const cirrose=/cirrose/.test(condicoes);
    const dii=/doen[c√ß]a inflam/.test(condicoes);
    const lynch=/lynch/.test(condicoes);

    if (sexo==='Feminino' && idade>=25 && idade<=64){
      addRec({ titulo:'Colo do √∫tero', quando:'Teste de HPV como prim√°rio (quando dispon√≠vel) com intervalo ampliado; com citologia, seguir periodicidade local.', diretrizes:'PCDT/MS (BR)', divergencia:'EUA (USPSTF/ACS/NCCN) usam HPV prim√°rio/co-teste 25‚Äì65, ~a cada 5 anos.', queryAgendar:'teste HPV preven√ß√£o colo do √∫tero laborat√≥rio' });
    }
    if (sexo==='Feminino' && idade>=25){
      const altoRiscoMama=hasBRCA||chestRTyoung||hf_mama;
      let quando='INCA (BR): mamografia a cada 2 anos 50‚Äì69.';
      let diverg='USPSTF: 40‚Äì74 bienal | ACS/NCCN: iniciar aos 40; ACS anual 45‚Äì54; alto risco considerar RM anual.';
      if(altoRiscoMama){ quando='Alto risco: RM de mamas anual + mamografia, iniciar ~30 anos (individualizar).'; }
      else if(idade<50){ quando+=' (antes dos 50, discutir in√≠cio conforme prefer√™ncia/risco)'; }
      addRec({ titulo:'Mama', quando, diretrizes:'INCA/MS (BR) + USPSTF/ACS/NCCN', divergencia:diverg, queryAgendar:'mamografia ressonancia de mamas' });
    }
    if ( (idade>=45 && idade<=75) || hf_colorretal || dii || lynch ){
      let quando='Iniciar aos 45: FIT anual OU DNA-fezes 1‚Äì3 anos OU colonoscopia a cada 10 anos (se normal).';
      if(hf_colorretal||dii||lynch){ quando='Risco aumentado: iniciar mais cedo (p.ex. 40 ou 10 anos antes do caso familiar) e preferir colonoscopia com intervalos encurtados (1‚Äì3 anos).'; }
      addRec({ titulo:'Colorretal', quando, diretrizes:'USPSTF / NCCN', divergencia:(hf_colorretal||dii||lynch)?'Crit√©rios variam entre diretrizes; seguir especialista.':null, queryAgendar:'colonoscopy colonoscopia' });
    }
    const elegUSPSTF=(pYears>=20)&&(idade>=50 && idade<=80)&&(fumante==='Sim'||(fumante==='Ex-fumante' && parou_ha<=15));
    const elegACS=(pYears>=20)&&(idade>=50 && idade<=80)&&(fumante==='Sim'||fumante==='Ex-fumante');
    if (elegUSPSTF||elegACS){
      addRec({ titulo:'Pulm√£o (TC de baixa dose)', quando:'Anual enquanto eleg√≠vel e candidato a tratamento curativo.', diretrizes:'USPSTF (50‚Äì80, ‚â•20 pack-years, cessa se >15a sem fumar) / ACS (remove limite de 15a)', divergencia:'Ex-fumantes >15 anos: USPSTF interrompe; ACS mant√©m.', queryAgendar:'low dose CT tomografia de baixa dose' });
    }
    if (sexo==='Masculino' && idade>=45){
      let quando='Brasil: n√£o h√° rastreamento populacional; decis√£o compartilhada (PSA ¬± toque).';
      let diverg='USPSTF: 55‚Äì69 decis√£o compartilhada; contra rastrear rotineiramente ‚â•70. NCCN/AUA individualizam por risco.';
      if(hf_prostata) diverg+=' (Hist√≥ria familiar favorece avalia√ß√£o mais precoce).';
      addRec({ titulo:'Pr√≥stata (PSA ¬± toque)', quando, diretrizes:'MS/INCA (BR) + USPSTF + NCCN/AUA', divergencia:diverg, queryAgendar:'exame PSA laborat√≥rio' });
    }
    if (cirrose){
      addRec({ titulo:'F√≠gado (em cirrose)', quando:'Ultrassom hep√°tico + AFP a cada 6 meses.', diretrizes:'Sociedades de hepatologia (pr√°tica consolidada)', divergencia:null, queryAgendar:'ultrassom abdome doppler laborat√≥rio' });
    }

    if(!recsEl.children.length){
      recsEl.innerHTML='<p class="muted">Nenhum exame padr√£o foi indicado pelas regras b√°sicas. Considere discutir necessidades espec√≠ficas com seu m√©dico.</p>';
    }
  });
</script>
</body>
</html>
